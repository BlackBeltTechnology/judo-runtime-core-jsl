model Functions

type numeric Integer(precision = 9, scale = 0)
type numeric Scaled(precision = 9, scale = 2)
type string String(max-length = 128)
type boolean Boolean
type date Date
type timestamp Timestamp
type time Time
type binary Binary

entity Entity {
    field Integer integerAttr
    field Scaled scaledAttr
    field String stringAttr
    field Boolean boolAttr
    field Date dateAttr
    field Timestamp timestampAttr
    field Time timeAttr
}

entity EntityWithPrimitiveDefaults {
    field Integer integerAttr = 1
    field Scaled scaledAttr = 2.34
    field String stringAttr = "test"
    field Boolean boolAttr = true
    field Date dateAttr = `2022-07-11`
    field Timestamp timestampAttr = `2022-07-11T19:09:33Z`
    field Time timeAttr = `23:59:59`
}
/* FIXME: JNG-3896
entity Functions {
    field Entity entity
    field EntityWithPrimitiveDefaults entityWithPrimitives
}

FIXME: use "extends Functions" once bug is fixed */
entity AnyTypeFunctions {
    field Entity entity
    field EntityWithPrimitiveDefaults entityWithPrimitives

    derived Boolean integerIsDefinedFalse => self.entity.integerAttr!isDefined()
    derived Boolean integerIsDefinedTrue => self.entityWithPrimitives.integerAttr!isDefined()
    derived Boolean integerIsUnDefinedTrue => self.entity.integerAttr!isUnDefined()
    derived Boolean integerIsUnDefinedFalse => self.entityWithPrimitives.integerAttr!isUnDefined()

    derived Boolean scaledIsDefinedFalse => self.entity.scaledAttr!isDefined()
    derived Boolean scaledIsDefinedTrue => self.entityWithPrimitives.scaledAttr!isDefined()
    derived Boolean scaledIsUnDefinedTrue => self.entity.scaledAttr!isUnDefined()
    derived Boolean scaledIsUnDefinedFalse => self.entityWithPrimitives.scaledAttr!isUnDefined()

    derived Boolean stringIsDefinedFalse => self.entity.stringAttr!isDefined()
    derived Boolean stringIsDefinedTrue => self.entityWithPrimitives.stringAttr!isDefined()
    derived Boolean stringIsUnDefinedTrue => self.entity.stringAttr!isUnDefined()
    derived Boolean stringIsUnDefinedFalse => self.entityWithPrimitives.stringAttr!isUnDefined()

    derived Boolean boolIsDefinedFalse => self.entity.boolAttr!isDefined()
    derived Boolean boolIsDefinedTrue => self.entityWithPrimitives.boolAttr!isDefined()
    derived Boolean boolIsUnDefinedTrue => self.entity.boolAttr!isUnDefined()
    derived Boolean boolIsUnDefinedFalse => self.entityWithPrimitives.boolAttr!isUnDefined()

    derived Boolean dateIsDefinedFalse => self.entity.dateAttr!isDefined()
    derived Boolean dateIsDefinedTrue => self.entityWithPrimitives.dateAttr!isDefined()
    derived Boolean dateIsUnDefinedTrue => self.entity.dateAttr!isUnDefined()
    derived Boolean dateIsUnDefinedFalse => self.entityWithPrimitives.dateAttr!isUnDefined()

    derived Boolean timestampIsDefinedFalse => self.entity.timestampAttr!isDefined()
    derived Boolean timestampIsDefinedTrue => self.entityWithPrimitives.timestampAttr!isDefined()
    derived Boolean timestampIsUnDefinedTrue => self.entity.timestampAttr!isUnDefined()
    derived Boolean timestampIsUnDefinedFalse => self.entityWithPrimitives.timestampAttr!isUnDefined()

    derived Boolean timeIsDefinedFalse => self.entity.timeAttr!isDefined()
    derived Boolean timeIsDefinedTrue => self.entityWithPrimitives.timeAttr!isDefined()
    derived Boolean timeIsUnDefinedTrue => self.entity.timeAttr!isUnDefined()
    derived Boolean timeIsUnDefinedFalse => self.entityWithPrimitives.timeAttr!isUnDefined()
}

entity StringFunctions {
    derived Integer length => "apple"!length()
    // derived String first => "apple"!first(2) FIXME: JNG-3897
    // derived String last => "apple"!last(1) FIXME: JNG-3897
    // derived Integer position => "apple"!position("p") FIXME: JNG-3897
    // derived String substring => "apple"!substring(2,3) FIXME: JNG-3897
    // derived String lower => "ApPlE"!lower() FIXME: JNG-3897
    // derived String lowerCase => "ApPlE"!lowerCase() FIXME: JNG-3897
    // derived String upper => "ApPlE"!upper() FIXME: JNG-3897
    // derived String upperCase => "ApPlE"!upperCase() FIXME: JNG-3897
    // derived String capitalize => "apPlE"!capitalize() FIXME: JNG-3897
    // derived Boolean matches => "apple"!matches(r".*pl.") FIXME: JNG-3897
    // derived Boolean like => "apple"!like("%pl_") FIXME: JNG-3897
    // derived Boolean ilike => "apPLe"!ilike("_pple") FIXME: JNG-3897
    // derived String replace => "apple"!replace("le", "endix") FIXME: JNG-3897
    derived String trim => " apple "!trim()
    // derived String ltrim => " apple "!ltrim() FIXME: JNG-3897
    // derived String rtrim => " apple "!rtrim() FIXME: JNG-3897
}

entity NumericFunctions {
    field Integer int = 1

    /* FIXME: JNG-3898
    derived Integer roundInt => self.int!round()
    derived Integer roundInt => 1!round()
    derived Integer roundScaled1 => 1.23!round()
    derived Integer roundScaled2 => 7.89!round()
    derived Integer roundScaled3 => 2.50!round()
    derived Integer roundScaledNegative1 => -2.5!round()
    derived Integer roundScaledNegative2 => -1.23!round()
    derived Integer roundScaledNegative3 => -7.89!round()
    */

    /* FIXME: JNG-3797
    derived Integer floorInt => 1!floor()
    derived Integer floorScaled1 => 2.9!floor()
    derived Integer floorScaled2 => -2.9!floor()

    derived Integer ceilInt => 1!ceil()
    derived Integer ceilScaled1 => 2.9!ceil()
    derived Integer ceilScaled2 => -2.9!ceil()

    derived Integer absInt => 1!abs()
    derived Scaled absScaled1 => 2.9!abs()
    derived Integer absScaled2 => -3!abs()
    */

    derived String intAsString => 1!asString()
    derived String scaledAsString => 123456.789!asString()
}

entity BooleanFunctions {
    field Boolean bool = true

    derived String ownBoolAsString => self.bool!asString()
    derived String trueAsString => true!asString()
    derived String falseAsString => false!asString()
}
