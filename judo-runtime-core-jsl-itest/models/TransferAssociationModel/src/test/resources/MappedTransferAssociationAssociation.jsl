model MappedTransferAssociationAssociation;

import judo::types;

// Single relation

entity EntityA {
    field String nameA;
    relation EntityB relationBonA;
}

entity EntityB {
    field String nameB;
}

transfer TransferA (EntityA a) {
    field String nameB <= a.nameA bind;
    relation TransferB relationBonA <= a.relationBonA choices:EntityB.all();
}

transfer TransferB (EntityB b) {
    field String nameB <= b.nameB bind;
}

// Single required relation
entity EntityC {
    field String nameC;
    relation EntityD relationDonC required;
}

entity EntityD {
    field String nameD;
}

transfer TransferC (EntityC c) {
    field String nameC <= c.nameC bind;
    relation TransferD relationDonC <= c.relationDonC choices:EntityD.all() required;
}

transfer TransferD (EntityD d) {
    field String nameD <= d.nameD bind;
}

// Multi relation
entity EntityE {
    field String nameE;
    relation EntityF[] relationFonE;
}

entity EntityF {
    field String nameF;
}

transfer TransferE (EntityE e) {
    field String nameE <= e.nameE bind;
    relation TransferF[] relationFonE <= e.relationFonE choices:EntityF.all();
}

transfer TransferF (EntityF f) {
    field String nameF <= f.nameF bind;
}

// TwoWay Relations

/*
Two way relation pattern

optional <-> optional
optional <-> required
optional <-> collection

required <-> optional
required <-> required
required <-> collection

collection <-> optional
collection <-> required
collection <-> collection

*/

entity EntityG {
    field String nameG;
    relation EntityH relationOptionalH opposite-add: relationGForOptionalH;
    relation EntityH relationRequiredH opposite-add: relationGForRequiredH required;
    relation EntityH[] relationCollectionH opposite-add: relationGForCollectionH;
}

entity EntityH {
    field String nameH;
}

transfer TransferG (EntityG g) {
    field String nameG <= g.nameG bind;
    relation TransferH relationOptionalH <= g.relationOptionalH choices:EntityH.all();
    relation TransferH relationRequiredH <= g.relationRequiredH choices:EntityH.all() required;
    relation TransferH[] relationCollectionH <= g.relationCollectionH choices:EntityH.all();
}

transfer TransferH (EntityH h) {
    field String nameH <= h.nameH bind;
    relation TransferG relationGForOptionalH <= h.relationGForOptionalH choices:EntityG.all();
    relation TransferG relationGForRequiredH <= h.relationGForRequiredH choices:EntityG.all();
    relation TransferG relationGForCollectionH <= h.relationGForCollectionH choices:EntityG.all();
}

entity EntityI {
    field String nameI;
    relation EntityJ relationOptionalJ opposite: relationRequiredIForOptionalJ;
    relation EntityJ[] relationCollectionJ opposite: relationRequiredIorCollectionJ;
}

entity EntityJ {
    field String nameJ;
    relation EntityI relationRequiredIForOptionalJ opposite: relationOptionalJ required;
    relation EntityI relationRequiredIorCollectionJ opposite: relationCollectionJ required;
}

transfer TransferI (EntityI i) {
    field String nameI <= i.nameI bind;
    relation TransferJ relationOptionalJ <= i.relationOptionalJ choices:EntityJ.all();
    relation TransferJ[] relationCollectionJ <= i.relationCollectionJ choices:EntityJ.all();
}

transfer TransferJ (EntityJ j) {
    field String nameJ <= j.nameJ bind;
    relation TransferI relationRequiredIForOptionalJ <= j.relationRequiredIForOptionalJ choices:EntityI.all() required;
    relation TransferI relationRequiredIorCollectionJ <= j.relationRequiredIorCollectionJ choices:EntityI.all() required;
}

entity EntityK {
    field String nameK;
    relation EntityL[] relationCollectionL opposite-add: relationCollectionKForCollectionL[];
}

entity EntityL {
    field String nameL;
}

transfer TransferK (EntityK k) {
    field String nameK <= k.nameK bind;
    relation TransferL[] relationCollectionL <= k.relationCollectionL choices:EntityL.all();
}

transfer TransferL (EntityL l) {
    field String nameL <= l.nameL bind;
    relation TransferK[] relationCollectionKForCollectionL <= l.relationCollectionKForCollectionL choices:EntityK.all();
}
